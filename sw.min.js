var SW=function(f){"use strict";function h(t,n){(n==null||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function d(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function m(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,w(r.key),r)}}function g(t,n,e){return n&&m(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function b(t,n){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=M(t))||n){e&&(t=e);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(i){throw i},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,s=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var i=e.next();return s=i.done,i},e:function(i){c=!0,o=i},f:function(){try{s||e.return==null||e.return()}finally{if(c)throw o}}}}function P(t,n){if(typeof t!="object"||!t)return t;var e=t[Symbol.toPrimitive];if(e!==void 0){var r=e.call(t,n);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function w(t){var n=P(t,"string");return typeof n=="symbol"?n:n+""}function M(t,n){if(t){if(typeof t=="string")return h(t,n);var e={}.toString.call(t).slice(8,-1);return e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set"?Array.from(t):e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?h(t,n):void 0}}function u(){for(var t,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];(t=console).log.apply(t,["【".concat(new Date().toLocaleTimeString(),"】")].concat(e))}function I(){var t,n,e=new Promise(function(r,a){t=r,n=a});return{ready:e,resolve:t,reject:n}}function S(t,n){var e={},r=b(n),a;try{for(r.s();!(a=r.n()).done;){var o=a.value;typeof t[o]<"u"&&(e[o]=t[o])}}catch(s){r.e(s)}finally{r.f()}return e}function k(t){var n={};t.headers.forEach(function(r,a){n[a]=r});var e=S(t,["body","url","method","cache","credentials","keepalive","referrer","referrerPolicy","mode","redirect"]);return e.headers=n,e}var E=function(){function t(){var n=this;d(this,t),this.msgId=0,this.resolveMap={},this.basePath="",self.addEventListener("message",function(e){u("worker on message",e);var r=e.data;if(r.type==="message-channel"){var a=r.data;n.initMessagePort(a.msgPort),n.initBasePath(a.port)}}),this.initBasePath(),this.initFetchEvent()}return g(t,[{key:"initFetchEvent",value:function(){var e=this;self.addEventListener("fetch",function(r){var a=r,o=a.request.url;if(o.startsWith(e.basePath)){var s=k(a.request);u("fetch url=".concat(e.basePath),s);var c=o.substring(e.basePath.length);s.url=o.replace(e.basePath,"/"),a.respondWith(e.sendRequest({path:c,request:s}))}})}},{key:"initMessagePort",value:function(e){var r=this;this.msgPort=e,this.msgPort.onmessage=function(a){var o=a.data;if(u("sw port on message",a),o.type==="response"){var s=o.data,c=r.resolveMap[s.msgId];if(c){u("sw port on resolve",s),delete r.resolveMap[s.msgId];var i=s.response,l=i.body,T=i.status,j=i.statusText,A=i.headers,v,p={status:T,statusText:j,headers:A};l instanceof Uint8Array||typeof l=="string"?v=new Response(l,p):v=Response.json(l,p),c(v)}}}}},{key:"sendRequest",value:function(e){var r=this.getMsgId();e.msgId=r,u("sw port send message",e,e.request.body);var a=[];e.request.body?a.push(e.request.body):delete e.request.body,this.msgPort.postMessage({type:"request",data:e},a);var o=I(),s=o.ready,c=o.resolve;return this.resolveMap[r]=c,s}},{key:"getMsgId",value:function(){return this.msgId++}},{key:"initBasePath",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=location,a=r.protocol,o=r.pathname,s=r.host;this.basePath="".concat(a,"//").concat(s).concat(o.substring(0,o.lastIndexOf("/")),"/:").concat(e||"","/"),u("basePath=".concat(this.basePath))}}])}(),y=g(function t(){d(this,t),this.request=new E,u("service worker 注册成功"),self.addEventListener("install",function(){u("service worker 安装成功")}),self.addEventListener("activate",function(){u("service worker 激活成功")})});return new y,f.ServiceWorkerProxy=y,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),f}({});
